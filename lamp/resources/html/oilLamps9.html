<!DOCTYPE html>
<html>
    <head>

        <!-- title -->
        <title>Virtual Oil Lamp</title>

        <!-- favicon -->
        <link href="../img/faculty_logo.png" type="image/x-icon" rel="icon">

        <!-- css -->
        <link href="../css/oil_lamp_style.css" type="text/css" rel="stylesheet">

    </head>
    <body>

    <!-- background sound -->
    <audio autoplay loop>
        <source src="../mp3/danno_budunge_melody.mp3" type="audio/mpeg">
    </audio>

    <!-- cursor -->
    <img id="candle-cursor" src="../img/candle.gif"/>

    <!-- guest photo -->
    <div id="guest-photo-div"><img id="guest-photo"></div>

    <!-- logo -->
    <div id="university-logo-div"><img id="university-logo" src="../img/university_logo.png"></div>
    <div id="faculty-logo-div"><img id="faculty-logo" src="../img/faculty_logo.png"></div>

    <!-- headings -->
    <div id="heading-div">
        <h1 id="topic">Students' Welcome Ceremony - 2022</h1>
        <h2 id="batch">6<sup>th</sup> Batch</h2>
        <h2 id="faculty-name">Faculty of Technology - University of Ruhuna</h2>
    </div>

    <!-- lighting point -->
    <div id="middle-point" class="lighting-points"><div class="blink"></div></div>
    <div id="bottom-point" class="lighting-points"><div class="blink"></div></div>

    <!-- fixed button  -->
    <div id="fixed-button-div">
        <h2 id="fixed-button">Designed by Department of Information and Communication Technology</h2>
    </div>

    <!-- threejs libraries -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.98.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.98.0/examples/js/controls/OrbitControls.js"></script>

    <!-- cursor customization -->
    <script>

        let x, y;
        let px = 0, py = 0;

        // image of cursor
        const cursor = document.getElementById("candle-cursor");

        // mouse press event
        window.addEventListener("mouseup", function(e) {
            cursor.style.left = (px + x) + "px";
            cursor.style.top = (py + y) + "px";
        })

        // mouse move event
        window.addEventListener("mousemove", function(e) {

            // gets the x,y position of the mouse cursor
            x = e.clientX;
            y = e.clientY;

            // sets the image to new relative position of the cursor
            cursor.style.left = (px + x) + "px";
            cursor.style.top = (py + y) + "px";

        });

    </script>

    <!-- flame model -->
    <script>
        function getFlameMaterial(isFrontSide){
            let side = isFrontSide ? THREE.FrontSide : THREE.BackSide;
            return new THREE.ShaderMaterial({
                uniforms: {
                    time: {value: 0},
                    light : {value : 2}
                },
                vertexShader: `
                    uniform float time;
                    uniform float light;
                    varying vec2 vUv;
                    varying float hValue;

                    //https://thebookofshaders.com/11/
                    // 2D Random
                    float random (in vec2 st) {
                        return fract(sin(dot(st.xy,
                                            vec2(12.9898,78.233)))
                                    * 43758.5453123);
                    }

                    // 2D Noise based on Morgan McGuire @morgan3d
                    // https://www.shadertoy.com/view/4dS3Wd
                    float noise (in vec2 st) {
                        vec2 i = floor(st);
                        vec2 f = fract(st);

                        // Four corners in 2D of a tile
                        float a = random(i);
                        float b = random(i + vec2(1.0, 0.0));
                        float c = random(i + vec2(0.0, 1.0));
                        float d = random(i + vec2(1.0, 1.0));

                        // Smooth Interpolation

                        // Cubic Hermine Curve.  Same as SmoothStep()
                        vec2 u = f*f*(3.0-2.0*f);
                        // u = smoothstep(0.,1.,f);

                        // Mix 4 coorners percentages
                        return mix(a, b, u.x) +
                                (c - a)* u.y * (1.0 - u.x) +
                                (d - b) * u.x * u.y;
                    }

                    void main() {
                        vUv = uv;
                        vec3 pos = position;


                        pos *= vec3(0.8, light, 0.725); // lamp flame
                        hValue = position.y;
                        //float sinT = sin(time * 2.) * 0.5 + 0.5;
                        float posXZlen = length(position.xz);

                        pos.y *= 1. + (cos((posXZlen + 0.25) * 3.1415926) * 0.25 + noise(vec2(0, time)) * 0.125 + noise(vec2(position.x + time, position.z + time)) * 0.5) * position.y; // flame height

                        pos.x += noise(vec2(time * 2., (position.y - time) * 4.0)) * hValue * 0.0312; // flame trembling
                        pos.z += noise(vec2((position.y - time) * 4.0, time * 2.)) * hValue * 0.0312; // flame trembling

                        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos,1.0);
                    }
                    `,
                fragmentShader: `
                    varying float hValue;
                    varying vec2 vUv;

                    // honestly stolen from https://www.shadertoy.com/view/4dsSzr
                    vec3 heatmapGradient(float t) {
                        return clamp((pow(t, 1.5) * 0.8 + 0.2) * vec3(smoothstep(0.0, 0.35, t) + t * 0.5, smoothstep(0.5, 1.0, t), max(1.0 - t * 1.7, t * 7.0 - 6.0)), 0.0, 1.0);
                    }

                    void main() {
                        float v = abs(smoothstep(0.0, 0.4, hValue) - 1.);
                        float alpha = (1. - v) * 0.99; // bottom transparency
                        alpha -= 1. - smoothstep(1.0, 0.97, hValue); // tip transparency
                        gl_FragColor = vec4(heatmapGradient(smoothstep(0.0, 0.3, hValue)) * vec3(0.95,0.95,0.4), alpha) ;
                        gl_FragColor.rgb = mix(vec3(0,0,1), gl_FragColor.rgb, smoothstep(0.0, 0.3, hValue)); // blueish for bottom
                        gl_FragColor.rgb += vec3(1, 0.9, 0.5) * (1.25 - vUv.y); // make the midst brighter
                        gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.66, 0.32, 0.03), smoothstep(0.95, 1., hValue)); // tip
                    }
                    `,
                transparent: true,
                side: side
            });
        }
    </script>

    <!-- guest photo change -->
    <script>

        /* ********************* ARRAY, INTERVAL, BACKGROUND ********************* */

        //photo array - VC, DVC, Dean-FOT, Senior student counsellor, ET-HOD, ICT-HOD, BST-HOD, AR-FOT, Example
        const guest_photo = ['1.png', '2.png', '3.png', '4.png', '5.png', '6.png', '7.png', '8.png', '9.png'];
        const interval = 7500;

        const table_background = "https://threejs.org/examples/textures/hardwood2_diffuse.jpg";
        const lamp_background = "https://raw.githubusercontent.com/MadushanSandaru1/Texture-for-Lamp/master/lamp_background.jpg";

        /* ********************* END ARRAY, INTERVAL, BACKGROUND ********************* */

        const guest_count_plus_one = guest_photo.length+1;
        let candle_number = guest_photo.length;

        let middle_lighting_point = document.getElementById('middle-point');
        let bottom_lighting_point = document.getElementById('bottom-point');

        // hide bottom point when load the page
        bottom_lighting_point.hidden = true;

        middle_lighting_point.addEventListener("click", function() {

            is_clicked = true;

            middle_lighting_point.hidden = true;

            setTimeout(function(){
                bottom_lighting_point.hidden = false;
                changeImage(candle_number);
            },2000);

        }, false);

        bottom_lighting_point.addEventListener("click", function() {

            is_clicked = true;

            --candle_number;

            if(candle_number >= 1)
            {

                flame(false, candle_number);
                flame(true, candle_number);
                bottom_lighting_point.hidden = true;
                controls.autoRotate = true;

                setTimeout(function(){
                    changeImage(candle_number);
                }, 1500);

                setTimeout(function(){
                    controls.autoRotate = false;
                    bottom_lighting_point.hidden = false;
                    if(candle_number == 1){
                        bottom_lighting_point.hidden = true;
                        controls.autoRotate = true;
                    }

                }, interval);
            }

        }, false);

        // fade animation of the guest photo
        function fadeIn(el) {
            el.style.opacity = 0;
            const tick = function () {
                el.style.opacity =+ el.style.opacity + 0.005;
                if (el.style.opacity < 1) {
                    (window.requestAnimationFrame && requestAnimationFrame(tick)) || setTimeout(tick, 16)
                }
            };
            tick();
        }

        // guest photo change event
        function changeImage(position) {
            const el = document.getElementById("guest-photo");
            if(position>1) {
                el.src = '../img/guest_photo/'+guest_photo[guest_count_plus_one-position];
                fadeIn(el);
            } else {
                el.parentNode.removeChild(el);
            }
        }

        changeImage(guest_count_plus_one);

    </script>

    <!-- oil lamp generation -->
    <script>

        // make scene
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.set(0, 10, 8).setLength(30); // zoom the camera
        var renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x101005); // background colour
        renderer.shadowMap.enabled = false;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        var controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enablePan = false;
        controls.minPolarAngle = THREE.Math.degToRad(60);
        controls.maxPolarAngle = THREE.Math.degToRad(95);
        controls.minDistance = 4;
        controls.maxDistance = 30;
        controls.enabled = false; //disable mouse control
        controls.autoRotate = false;
        controls.autoRotateSpeed = 1;
        controls.target.set(0, 4, 4);
        controls.update();

        // set page background image
        loader = new THREE.TextureLoader();
        loader.setCrossOrigin("");
        bgTexture = loader.load(lamp_background,
            function ( texture ) {
                var img = texture.image;
                bgWidth= img.width;
                bgHeight = img.height;
            }
        );
        scene.background = bgTexture;

        var light = new THREE.DirectionalLight(0xffffff, 0.7);
        light.position.setScalar(10);
        scene.add(light);
        scene.add(new THREE.AmbientLight(0xffffff, 0.0625));

        // lamp-case model
        var casePath = new THREE.Path();
        casePath.moveTo(0, 0);
        casePath.lineTo(0, 0);
        casePath.absarc(1.5, 0.5, 0.5, Math.PI * 1.5, Math.PI * 2);
        casePath.lineTo(2, 1.5);
        casePath.lineTo(1.99, 1.5);
        casePath.lineTo(1.9, 0.5);
        var caseGeo = new THREE.LatheBufferGeometry(casePath.getPoints(), 64);
        var caseMat = new THREE.MeshStandardMaterial({color: "silver" });


        /* ********************* CANDLE ********************* */

        // candle right near
        var caseMesh = new THREE.Mesh(caseGeo, caseMat);
        caseMesh.position.set(7.5, 0, 10.5); //(x, h, y)
        caseMesh.castShadow = true;

        // candle2 right center
        var caseMesh2 = new THREE.Mesh(caseGeo, caseMat);
        caseMesh2.position.set(9.8, 0, 3.5);
        caseMesh2.castShadow = true;

        // candle3 right far
        var caseMesh3 = new THREE.Mesh(caseGeo, caseMat);
        caseMesh3.position.set(6.5, 0, -3.3);
        caseMesh3.castShadow = true;

        // candle4 middle far
        var caseMesh4 = new THREE.Mesh(caseGeo, caseMat);
        caseMesh4.position.set(-0.4, 0, -5.8);
        caseMesh4.castShadow = true;

        // candle5 left far
        var caseMesh5 = new THREE.Mesh(caseGeo, caseMat);
        caseMesh5.position.set(-7.3, 0, -2.7);
        caseMesh5.castShadow = true;

        // candle6 left center
        var caseMesh6 = new THREE.Mesh(caseGeo, caseMat);
        caseMesh6.position.set(-9.7, 0, 4.2);
        caseMesh6.castShadow = true;

        // candle7 left near
        var caseMesh7 = new THREE.Mesh(caseGeo, caseMat);
        caseMesh7.position.set(-6.8, 0, 10.8);
        caseMesh7.castShadow = true;

        // candle8 middle near
        var caseMesh8 = new THREE.Mesh(caseGeo, caseMat);
        caseMesh8.position.set(0, 0, 14);
        caseMesh8.castShadow = true;

        // candle9 middle
        var caseMesh9 = new THREE.Mesh(caseGeo, caseMat);
        caseMesh9.position.set(0, 0, 3);
        caseMesh9.castShadow = true;

        /* ********************* END CANDLE ********************* */


        // paraffin model
        var paraffinPath = new THREE.Path();
        paraffinPath.moveTo(0, -.25);
        paraffinPath.lineTo(0, -.25);
        paraffinPath.absarc(1, 0, 0.25, Math.PI * 1.5, Math.PI * 2);
        paraffinPath.lineTo(1.25, 0);
        paraffinPath.absarc(1.89, 0.1, 0.1, Math.PI * 1.5, Math.PI * 2);

        var paraffinGeo = new THREE.LatheBufferGeometry(paraffinPath.getPoints(), 64);
        paraffinGeo.translate(0, 1.25, 0);
        var paraffinMat = new THREE.MeshStandardMaterial({color: 0xffff99, side: THREE.BackSide, metalness: 0, roughness: 0.75});


        /* ********************* PARAFFIN ********************* */

        // paraffin
        var paraffinMesh = new THREE.Mesh(paraffinGeo, paraffinMat);
        paraffinMesh.position.set(0, 0, 0);
        caseMesh.add(paraffinMesh);

        // paraffin2
        var paraffinMesh2 = new THREE.Mesh(paraffinGeo, paraffinMat);
        paraffinMesh2.position.set(0, 0, 0);
        caseMesh2.add(paraffinMesh2);

        // paraffin3
        var paraffinMesh3 = new THREE.Mesh(paraffinGeo, paraffinMat);
        paraffinMesh3.position.set(0, 0, 0);
        caseMesh3.add(paraffinMesh3);

        // paraffin4
        var paraffinMesh4 = new THREE.Mesh(paraffinGeo, paraffinMat);
        paraffinMesh4.position.set(0, 0, 0);
        caseMesh4.add(paraffinMesh4);

        // paraffin5
        var paraffinMesh5 = new THREE.Mesh(paraffinGeo, paraffinMat);
        paraffinMesh5.position.set(0, 0, 0);
        caseMesh5.add(paraffinMesh5);

        // paraffin6
        var paraffinMesh6 = new THREE.Mesh(paraffinGeo, paraffinMat);
        paraffinMesh6.position.set(0, 0, 0);
        caseMesh6.add(paraffinMesh6);

        // paraffin7
        var paraffinMesh7 = new THREE.Mesh(paraffinGeo, paraffinMat);
        paraffinMesh7.position.set(0, 0, 0);
        caseMesh7.add(paraffinMesh7);

        // paraffin8
        var paraffinMesh8 = new THREE.Mesh(paraffinGeo, paraffinMat);
        paraffinMesh8.position.set(0, 0, 0);
        caseMesh8.add(paraffinMesh8);

        // paraffin9
        var paraffinMesh9 = new THREE.Mesh(paraffinGeo, paraffinMat);
        paraffinMesh9.position.set(0, 0, 0);
        caseMesh9.add(paraffinMesh9);

        /* ********************* END PARAFFIN ********************* */


        // candle wick model
        var candlewickProfile = new THREE.Shape();
        candlewickProfile.absarc(0, 0, 0.0625, 0, Math.PI * 2);

        var candlewickCurve = new THREE.CatmullRomCurve3([
            new THREE.Vector3(0, 0, 0),
            new THREE.Vector3(0, 0.5, -0.0625),
            new THREE.Vector3(0.25, 0.5, 0.125)
        ]);

        var candlewickGeo = new THREE.ExtrudeBufferGeometry(candlewickProfile, {
            steps: 8,
            bevelEnabled: false,
            extrudePath: candlewickCurve
        });

        var colors = [];
        var color1 = new THREE.Color("black");
        var color2 = new THREE.Color(0x994411);
        var color3 = new THREE.Color(0xffff44);

        for (let i = 0; i < candlewickGeo.attributes.position.count; i++){
            if (candlewickGeo.attributes.position.getY(i) < 0.4){
                color1.toArray(colors, i * 3);
            }
            else {
                color2.toArray(colors, i * 3);
            };
            if (candlewickGeo.attributes.position.getY(i) < 0.15) color3.toArray(colors, i * 3);
        }

        candlewickGeo.addAttribute( 'color', new THREE.BufferAttribute( new Float32Array(colors), 3 ) );
        candlewickGeo.translate(0, 0.95, 0);
        var candlewickMat = new THREE.MeshBasicMaterial({vertexColors: THREE.VertexColors});


        /* ********************* CANDLE WICK, LIGHT ********************* */

        var candlewickMesh = new THREE.Mesh(candlewickGeo, candlewickMat);
        var candlewickMesh2 = new THREE.Mesh(candlewickGeo, candlewickMat);
        var candlewickMesh3 = new THREE.Mesh(candlewickGeo, candlewickMat);
        var candlewickMesh4 = new THREE.Mesh(candlewickGeo, candlewickMat);
        var candlewickMesh5 = new THREE.Mesh(candlewickGeo, candlewickMat);
        var candlewickMesh6 = new THREE.Mesh(candlewickGeo, candlewickMat);
        var candlewickMesh7 = new THREE.Mesh(candlewickGeo, candlewickMat);
        var candlewickMesh8 = new THREE.Mesh(candlewickGeo, candlewickMat);
        var candlewickMesh9 = new THREE.Mesh(candlewickGeo, candlewickMat);

        caseMesh.add(candlewickMesh);
        caseMesh2.add(candlewickMesh2);
        caseMesh3.add(candlewickMesh3);
        caseMesh4.add(candlewickMesh4);
        caseMesh5.add(candlewickMesh5);
        caseMesh6.add(candlewickMesh6);
        caseMesh7.add(candlewickMesh7);
        caseMesh8.add(candlewickMesh8);
        caseMesh9.add(candlewickMesh9);

        // candle light1
        var candleLight = new THREE.PointLight(0xffaa33, 1, 5, 2);
        candleLight.position.set(0, 3, 0);
        candleLight.castShadow = false;

        // candle light2
        var candleLight2 = new THREE.PointLight(0xffaa33, 1, 5, 2);
        candleLight2.position.set(6, 3, 0);
        candleLight2.castShadow = false;

        // candle light3
        var candleLight3 = new THREE.PointLight(0xffaa33, 1, 5, 2);
        candleLight3.position.set(6, 3, 0);
        candleLight3.castShadow = false;

        // candle light4
        var candleLight4 = new THREE.PointLight(0xffaa33, 1, 5, 2);
        candleLight4.position.set(6, 3, 0);
        candleLight4.castShadow = false;

        // candle light5
        var candleLight5 = new THREE.PointLight(0xffaa33, 1, 5, 2);
        candleLight5.position.set(6, 3, 0);
        candleLight5.castShadow = false;

        // candle light6
        var candleLight6 = new THREE.PointLight(0xffaa33, 1, 5, 2);
        candleLight6.position.set(6, 3, 0);
        candleLight6.castShadow = false;

        // candle light7
        var candleLight7 = new THREE.PointLight(0xffaa33, 1, 5, 2);
        candleLight7.position.set(6, 3, 0);
        candleLight7.castShadow = false;

        // candle light8
        var candleLight8 = new THREE.PointLight(0xffaa33, 1, 5, 2);
        candleLight8.position.set(6, 3, 0);
        candleLight8.castShadow = false;

        // candle light9
        var candleLight9 = new THREE.PointLight(0xffaa33, 1, 5, 2);
        candleLight9.position.set(6, 3, 0);
        candleLight9.castShadow = false;

        /* ********************* END CANDLE WICK, LIGHT ********************* */


        // flame model
        var flameMaterials = [];
        function flame(isFrontSide, candle_number){
            let flameGeo = new THREE.SphereBufferGeometry(0.5, 32, 32);
            flameGeo.translate(0, 0.5, 0);
            let flameMat = getFlameMaterial(true);
            flameMaterials.push(flameMat);


            /* ********************* FLAME ********************* */

            //flame1
            if(candle_number == 1) {
                let flame = new THREE.Mesh(flameGeo, flameMat);
                flame.position.set(0, 1.2, 0.05);
                caseMesh.add(flame);
            }

            //flame2
            if(candle_number == 2) {
                let flame2 = new THREE.Mesh(flameGeo, flameMat);
                flame2.position.set(0, 1.2, 0.05);
                caseMesh2.add(flame2);
            }
            //flame3
            if(candle_number == 3) {
                let flame3 = new THREE.Mesh(flameGeo, flameMat);
                flame3.position.set(0, 1.2, 0.05);
                caseMesh3.add(flame3);
            }

            //flame4
            if(candle_number == 4) {
                let flame4 = new THREE.Mesh(flameGeo, flameMat);
                flame4.position.set(0, 1.2, 0.05);
                caseMesh4.add(flame4);
            }

            //flame5
            if(candle_number == 5) {
                let flame5 = new THREE.Mesh(flameGeo, flameMat);
                flame5.position.set(0, 1.2, 0.05);
                caseMesh5.add(flame5);
            }

            //flame6
            if(candle_number == 6) {
                let flame6 = new THREE.Mesh(flameGeo, flameMat);
                flame6.position.set(0, 1.2, 0.05);
                caseMesh6.add(flame6);
            }

            //flame7
            if(candle_number == 7) {
                let flame7 = new THREE.Mesh(flameGeo, flameMat);
                flame7.position.set(0, 1.2, 0.05);
                caseMesh7.add(flame7);
            }

            //flame8
            if(candle_number == 8) {
                let flame8 = new THREE.Mesh(flameGeo, flameMat);
                flame8.position.set(0, 1.2, 0.05);
                caseMesh8.add(flame8);
            }

            //flame9
            if(candle_number == 9) {
                let flame9 = new THREE.Mesh(flameGeo, flameMat);
                flame9.position.set(0, 1.2, 0.05);
                caseMesh9.add(flame9);
            }

            /* ********************* END FLAME ********************* */
        }

        flame(false, candle_number);
        flame(true, candle_number);

        // table
        var tableGeo = new THREE.CylinderBufferGeometry(16, 16, 0.5, 100);
        tableGeo.translate(0, 0, 4);
        var tableMat = new THREE.MeshStandardMaterial({map: new THREE.TextureLoader().load(table_background), metalness: 0, roughness: 0.50});
        var tableMesh = new THREE.Mesh(tableGeo, tableMat);
        tableMesh.receiveShadow = true;


        /* ********************* TABLE MESH ********************* */

        tableMesh.add(caseMesh);
        tableMesh.add(caseMesh2);
        tableMesh.add(caseMesh3);
        tableMesh.add(caseMesh4);
        tableMesh.add(caseMesh5);
        tableMesh.add(caseMesh6);
        tableMesh.add(caseMesh7);
        tableMesh.add(caseMesh8);
        tableMesh.add(caseMesh9);

        /* ********************* END TABLE MESH ********************* */


        scene.add(tableMesh);

        var clock = new THREE.Clock();
        var time = 0;
        var light = 0;
        var is_clicked = false;

        render();

        function render(){
            requestAnimationFrame(render);

            if(is_clicked) {
                light += 0.03;
                if (Math.floor(light) == 3) {
                    is_clicked = false;

                    renderer.shadowMap.enabled = true;
                    candleLight.castShadow = true;


                    /* ********************* CANDLE LIGHTING ********************* */

                    if(candle_number == 1){
                        caseMesh.add(candleLight);
                        controls.autoRotate = true;
                    }
                    if (candle_number == 2){
                        caseMesh2.add(candleLight2);
                    }

                    if (candle_number == 3) {
                        caseMesh3.add(candleLight3);
                    }

                    if (candle_number == 4) {
                        caseMesh4.add(candleLight4);
                    }

                    if (candle_number == 5){
                        caseMesh5.add(candleLight5);
                    }
                    if (candle_number == 6){
                        caseMesh6.add(candleLight6);
                    }
                    if (candle_number == 7){
                        caseMesh7.add(candleLight7);
                    }
                    if (candle_number == 8){
                        caseMesh8.add(candleLight8);
                    }
                    if (candle_number == 9){
                        caseMesh9.add(candleLight9);
                    }

                    /* ********************* END CANDLE LIGHTING ********************* */
                }
            }

            time += clock.getDelta();
            flameMaterials[0].uniforms.time.value = time;
            flameMaterials[1].uniforms.time.value = time;
            flameMaterials[0].uniforms.light.value = light;
            flameMaterials[1].uniforms.light.value = light;

            /* ********************* LIGHTING POSITION ********************* */

            candleLight.position.x = Math.sin(time * Math.PI) * 0.25;
            candleLight.position.z = Math.cos(time * Math.PI * 0.75) * 0.25;
            candleLight.intensity = 2 + Math.sin(time * Math.PI * 2) * Math.cos(time * Math.PI * 1.5) * 0.25;

            candleLight2.position.x = Math.sin(time * Math.PI) * 0.25;
            candleLight2.position.z = Math.cos(time * Math.PI * 0.75) * 0.25;
            candleLight2.intensity = 2 + Math.sin(time * Math.PI * 2) * Math.cos(time * Math.PI * 1.5) * 0.25;

            candleLight3.position.x = Math.sin(time * Math.PI) * 0.25;
            candleLight3.position.z = Math.cos(time * Math.PI * 0.75) * 0.25;
            candleLight3.intensity = 2 + Math.sin(time * Math.PI * 2) * Math.cos(time * Math.PI * 1.5) * 0.25;

            candleLight4.position.x = Math.sin(time * Math.PI) * 0.25;
            candleLight4.position.z = Math.cos(time * Math.PI * 0.75) * 0.25;
            candleLight4.intensity = 2 + Math.sin(time * Math.PI * 2) * Math.cos(time * Math.PI * 1.5) * 0.25;

            candleLight5.position.x = Math.sin(time * Math.PI) * 0.25;
            candleLight5.position.z = Math.cos(time * Math.PI * 0.75) * 0.25;
            candleLight5.intensity = 2 + Math.sin(time * Math.PI * 2) * Math.cos(time * Math.PI * 1.5) * 0.25;

            candleLight6.position.x = Math.sin(time * Math.PI) * 0.25;
            candleLight6.position.z = Math.cos(time * Math.PI * 0.75) * 0.25;
            candleLight6.intensity = 2 + Math.sin(time * Math.PI * 2) * Math.cos(time * Math.PI * 1.5) * 0.25;

            candleLight7.position.x = Math.sin(time * Math.PI) * 0.25;
            candleLight7.position.z = Math.cos(time * Math.PI * 0.75) * 0.25;
            candleLight7.intensity = 2 + Math.sin(time * Math.PI * 2) * Math.cos(time * Math.PI * 1.5) * 0.25;

            candleLight8.position.x = Math.sin(time * Math.PI) * 0.25;
            candleLight8.position.z = Math.cos(time * Math.PI * 0.75) * 0.25;
            candleLight8.intensity = 2 + Math.sin(time * Math.PI * 2) * Math.cos(time * Math.PI * 1.5) * 0.25;

            candleLight9.position.x = Math.sin(time * Math.PI) * 0.25;
            candleLight9.position.z = Math.cos(time * Math.PI * 0.75) * 0.25;
            candleLight9.intensity = 2 + Math.sin(time * Math.PI * 2) * Math.cos(time * Math.PI * 1.5) * 0.25;

            /* ********************* END LIGHTING POSITION ********************* */

            controls.update();
            renderer.render(scene, camera);
        }

    </script>

    </body>
</html>